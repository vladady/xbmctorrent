from xbmctorrent import plugin, magnet, scrapers
from xbmctorrent.ga import tracked
from xbmctorrent.utils import ensure_fanart
from xbmctorrent.platform import PLATFORM
from xbmctorrent.scrapers import \
    MODULES, \
    eztv, \
    yify, \
    kickass, \
    filelist, \
    tpb


def _ensure_settings():
    import os
    firstrun = os.path.join(plugin.addon.getAddonInfo("path"), ".firstrun")
    if not os.path.exists(firstrun):
        with open(firstrun, "w"):
            plugin.set_setting("base_tpb", "http://thepiratebay.org") # Properly set TPB for now
            plugin.notify("Please review your settings.")
            plugin.open_settings()


@plugin.route("/")
@ensure_fanart
@tracked(force=True)
def index():
    _ensure_settings()

    if PLATFORM["os"] not in ["android", "linux", "windows", "darwin"]:
        plugin.notify("Your system \"%(os)s_%(arch)s\" is not supported." % PLATFORM, delay=15000)

    for module in MODULES:
        yield {
            "label": module["name"],
            "thumbnail": module["image"],
            "path": plugin.url_for(module["view"]),
        }
